/**
 * SendBird JavaScript SDK v2.4.5
 */
var _isLeavingPage=!1;"object"==typeof window&&(window.onbeforeunload=function(){_isLeavingPage=!0}),function(e,n){"function"==typeof define&&define.amd?define([],n()):"object"==typeof exports?module.exports=n():(e.SB=n(),e.sendbird=e.SB.getInstance())}(this,function(){function e(e,n,s,t,i,o){var c=new XMLHttpRequest;if("withCredentials"in c){try{switch(c=new XMLHttpRequest,s.toLowerCase()){case"get":c.open("GET",e);break;default:c.open("POST",e)}c.onload=function(){if(c.status>=r&&c.status<a){var e=c.responseText;i(JSON.parse(e))}else o(c.status,c.statusText)},c.onerror=function(){o(404,"There was a connection error")}}catch(u){c=new ActiveXObject("Microsoft.XMLHTTP");try{switch(s.toLowerCase()){case"get":c.open("GET",e);break;default:c.open("POST",e)}}catch(g){c.open("POST",e)}c.onreadystatechange=function(){if(4==c.readyState)if(c.status>=r&&c.status<a){var e=c.responseText;i(JSON.parse(e))}else o(c.status,c.statusText)}}c.setRequestHeader("Content-Type","text/plain; charset=UTF-8");for(var p in t)c.setRequestHeader(p,t[p])}else{c=new XDomainRequest,c.withCredentials=!0;try{switch(s.toLowerCase()){case"get":c.open("GET",e);break;default:c.open("POST",e)}}catch(g){c.open("POST",e)}c.onload=function(){var e=JSON.parse(c.responseText);e.error?o(c.status,c.statusText):i(e)},c.onerror=function(){o(404,"There was a connection error")}}c.send(JSON.stringify(n))}var n=!1,s=window.console||{log:function(){}},t=function(e){n&&s.log(e)},i=function(e){e=e||{};for(var n=arguments.length,s=1;n>s;s++)if(arguments[s])for(var t in arguments[s])arguments[s].hasOwnProperty(t)&&(e[t]=arguments[s][t]);return e};"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var r=200,a=400,o=function(){function e(){var e=new c;return e}var n,s=function(s){var t=i({},{newInstance:!1},s);return t.newInstance?e():(n||(n=e()),n)};return{getInstance:s}}(),c=function(){function s(e){return c(f+y.app_id),g+"v"+l.replace(/[^(0-9)]/gi,"")+"/"+e}function o(e){return c(f+y.app_id),g+"v3/"+e}function c(n,s,i){if(d)p="ws://localtest.me:9000",g="http://api.localtest.me:8000/","function"==typeof s&&s();else{var r=(new Date).getTime()/1e3;0==I||I-r>3?e(n,{},"GET",{SendBird:v+y.app_id},function(e){p=e.ws_server,g=e.api_server+"/",t("Routing Info Update: "+p+", "+g),I=r,"function"==typeof s&&s()},function(e,n){"function"==typeof i&&i(e,n)}):"function"==typeof s&&s()}}function u(e){y.app_id=e.app_id,y.guest_id=e.guest_id,y.user_name=e.user_name,y.image_url=void 0==e.image_url||null==e.image_url?"":e.image_url,y.access_token=void 0==e.access_token||null==e.access_token?"":e.access_token,D({successFunc:function(n){e.successFunc(n)},errorFunc:function(n,s){e.errorFunc(n,s)},async:e.async})}var g,p,d=!1,l="1",f="https://sbrouting.sendbird.com/app/",_="2.4.5",m="/?p=JS&pv="+encodeURI(navigator.userAgent)+"&sv="+_+"&ai=",v="JS,"+encodeURI(navigator.userAgent)+","+_+",",S=null,h={MESG:"MESG",FILE:"FILE",LOGI:"LOGI",JOIN:"JOIN",SYSM:"SYSM",BRDM:"BRDM",MCUP:"MCUP",READ:"READ",TPST:"TPST",TPEN:"TPEN",BAAN:"BAAN",FREZ:"FREZ",PING:"PING",PONG:"PONG"},y={},k={},F=0,T=0,M=null,O=null,P=null,R=0,N=!1,w=0,b=1e4,I=0,C=function(e,n){switch(e){case h.MESG:L.onMessageReceived(JSON.parse(n));break;case h.SYSM:L.onSystemMessageReceived(JSON.parse(n));break;case h.FILE:L.onFileMessageReceived(JSON.parse(n));break;case h.BRDM:L.onBroadcastMessageReceived(JSON.parse(n));break;case h.TPST:L.onTypeStartReceived(JSON.parse(n));break;case h.TPEN:L.onTypeEndReceived(JSON.parse(n));break;case h.PONG:t(h.PONG);break;case h.READ:L.onReadReceived(JSON.parse(n));break;case h.BAAN:L.onBanReceived(JSON.parse(n));break;case h.FREZ:var s=JSON.parse(n),i=!1;try{i=s.freeze}catch(r){i=!1}k.data=JSON.stringify({freeze:i}),L.onChannelFreezeReceived(s);break;default:L.onUndefinedMessageReceived(e,JSON.parse(n))}return JSON.parse(n)},E={successFunc:function(e){},errorFunc:function(e,n){t(e),t(n)}},L={onMessageReceived:function(e){t(e)},onSystemMessageReceived:function(e){t(e)},onFileMessageReceived:function(e){t(e)},onBroadcastMessageReceived:function(e){t(e)},onReadReceived:function(e){t(e)},onMessagingChannelUpdateReceived:function(e){t(e)},onTypeStartReceived:function(e){t(e)},onTypeEndReceived:function(e){t(e)},onMessageDelivery:function(e){t(e)},onBanReceived:function(e){t(e)},onChannelFreezeReceived:function(e){t(e)},onUndefinedMessageReceived:function(e,n){t(e),t(n)}},B=6,J=5,D=function(n){t("=== Start SendBird SDK ===");var a=i({},E,n),o="guest_login/",u={guest_id:y.guest_id,app_id:y.app_id,nickname:y.user_name,image_url:y.image_url,access_token:y.access_token};void 0!=y.gcm_reg_token&&""!=y.gcm_reg_token&&(u.gcm_reg_token=y.gcm_reg_token),void 0!=y.apns_device_token&&""!=y.apns_device_token&&(u.apns_device_token=y.apns_device_token),c(f+y.app_id,function(){e(s(o),u,"POST",{SendBird:v+y.app_id},function(e){e.error?a.errorFunc(r,e.message):(y.guest_key=e.key,a.successFunc({}))},function(e,n){a.errorFunc(e,n)})},function(e,n){a.errorFunc(e,n)})},G=function(n,a){t("=== Join Channel ===");var o=i({},E,a),c="channel_join/",u={app_id:y.app_id,session_key:y.guest_key,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(e.isMessaging=!1,i(k,e),g=k,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},A=function(n,a){t("=== Leave Channel ===");var o=i({},E,a),c="channel_leave",u={app_id:y.app_id,session_key:y.guest_key,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},U=function(n,a){t("=== Member List ===");var o=i({},E,a),c="member_list/",u={app_id:y.app_id,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},x=function(n){t("=== Channel List ==="),n=i({},{limit:20,page:1,query:""},n);var a=i({},E,n),o="channel_list/",c={app_id:y.app_id,page:a.page,limit:a.limit,query:a.query},u={};e(s(o),c,"POST",{SendBird:v+y.app_id},function(e){e.error?a.errorFunc(r,e.message):(u=e,a.successFunc(u))},function(e,n){a.errorFunc(e,n)})},W=function(e){x(e)},z=function(e){return void 0!=e.last_message&&""!=e.last_message&&(e.last_message=JSON.parse(e.last_message.substring(4))),e},j=function(n,a){t("=== Join Messaging Channel ===");var o=i({},E,a),c="messaging_join/",u={app_id:y.app_id,session_key:y.guest_key,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(e.channel.isMessaging=!0,i(k,e.channel),g=e,o.successFunc(z(g)))},function(e,n){o.errorFunc(e,n)})},q=function(n,a){t("=== Start Messaging ==="),n=n instanceof Array?n:new Array(n);var o=i({},E,a),c="messaging_start/",u={app_id:y.app_id,session_key:y.guest_key,guest_ids:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(i(k,e.channel),g=e,o.successFunc(z(g)))},function(e,n){o.errorFunc(e,n)})},H=function(e,n,s){if(2==arguments.length){var t=arguments[1].channel_url;(void 0==t||""==t)&&(t=k.channel_url),X(arguments[0],t,arguments[1])}else X(e,n,s)},X=function(n,a,o){t("=== Invite Messaging ==="),n=n instanceof Array?n:new Array(n);var c=i({},E,o),u="messaging_invite/",g={app_id:y.app_id,session_key:y.guest_key,channel_url:a,guest_ids:n},p={};e(s(u),g,"POST",{SendBird:v+y.app_id},function(e){e.error?c.errorFunc(r,e.message):(i(k,e.channel),p=e,c.successFunc(z(p)))},function(e,n){c.errorFunc(e,n)})},Y=function(n,a){t("=== End Messaging ===");var o=i({},E,a),c="messaging_end/",u={app_id:y.app_id,session_key:y.guest_key,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(i(k,e),g=e,o.successFunc(z(g)))},function(e,n){o.errorFunc(e,n)})},Z=function(n){t("=== Messaging Channel List ==="),n=i({},{limit:9999,page:1},n);var a=i({},E,n),o="messaging_list/",c={app_id:y.app_id,session_key:y.guest_key,page:a.page,limit:a.limit},u={};e(s(o),c,"POST",{SendBird:v+y.app_id},function(e){e.error?a.errorFunc(r,e.message):(u=e,u.channels.forEach(function(e,n){e=z(e)}),a.successFunc(u))},function(e,n){a.errorFunc(e,n)})},K=function(n){t("=== Messaging Channel List ==="),n=i({},{limit:9999,page:1},n);var s=i({},E,n),a="messaging_list/",c={app_id:y.app_id,session_key:y.guest_key,page:s.page,limit:s.limit},u={};e(o(a),c,"POST",{SendBird:v+y.app_id},function(e){e.error?s.errorFunc(r,e.message):(u=e,u.channels.forEach(function(e,n){e=z(e)}),s.successFunc(u))},function(e,n){s.errorFunc(e,n)})},$=function(n,a){t("=== Messaging Channel Info ===");var o=i({},E,a),c="messaging_info/",u={app_id:y.app_id,session_key:y.guest_key,channel_id:n};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):L.onMessagingChannelUpdateReceived(z(e))},function(e,n){o.errorFunc(e,n)})},Q=function(n,a){t("=== Message Mark As Read ===");var o=i({},E,a),c="mark_as_read/",u={app_id:y.app_id,session_key:y.guest_key,channel_url:n},g={};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):(g=e,o.successFunc(g))},function(e,n){o.errorFunc(e,n)})},V=function(n){t("=== Message Load More ==="),n=i({},{limit:20},n);var a=i({},E,n),o=(new Date).getTime(),c="message_list",u={app_id:y.app_id,session_key:y.guest_key,channel_url:k.channel_url,message_ts:0==T?o:T,prev_limit:a.limit,next_limit:0,include:!1},g=[];e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?a.errorFunc(r,e.message):(e.messages.forEach(function(e,n){var s=JSON.parse(e.substring(4));0==T?T=s.ts:T>s.ts&&(T=s.ts),g.push(ke(e))}),a.successFunc({messages:g}))},function(e,n){a.errorFunc(e,n)})},ee=function(n){t("=== User List ==="),n=i({},{token:"",page:1,limit:30},n);var a=i({},E,n),o="user_list/",c={app_id:y.app_id,session_key:y.guest_key,token:a.token,page:a.page,limit:a.limit};e(s(o),c,"POST",{SendBird:v+y.app_id},function(e){e.error?a.errorFunc(r,e.message):a.successFunc(e)},function(e,n){a.errorFunc(e,n)})},ne=function(e,n){t("=== Upload File ===");var s=i({},E,n),o="upload_file/",c='{"app_id": "'+y.app_id+'"}',u=new FormData;u.append("meta",c),u.append("file",e);var p="",d=g+"v"+l.replace(/[^(0-9)]/gi,"")+"/"+o,f=void 0==s.async?!0:s.async,_=new XMLHttpRequest;_.open("POST",d,f),_.onload=function(){if(_.status>=r&&_.status<a){var n=_.responseText,t=JSON.parse(n);t.error?s.errorFunc(r,t.message):(p={error:!1,url:t.url},he({url:t.url,name:e.name,type:e.type,size:e.size,custom:""}),s.successFunc(p))}else s.errorFunc(_.status,_.statusText)},_.send(u)},se=function(){t("=== Typing Start ===");var e=(new Date).getTime();pe(h.TPST,{channel_id:k.id,time:e}),w=e,N=!0},te=function(){t("=== Typing End ===");var e=(new Date).getTime();pe(h.TPEN,{channel_id:k.id,time:e}),w=0,N=!1},ie=(setInterval(function(){var e=(new Date).getTime();N&&e-w>b&&te()},b),function(n,a){t("=== Delete Message ===");var o=i({},E,a),c="message_delete/",u={app_id:y.app_id,session_key:y.guest_key,msg_id:n};e(s(c),u,"POST",{SendBird:v+y.app_id},function(e){e.error?o.errorFunc(r,e.message):o.successFunc(e)},function(e,n){o.errorFunc(e,n)})}),re=function(e){t("=== Web Socket Connect ==="),ue();var n=i({},E,e);S=new WebSocket(p+m+y.app_id),S.onopen=function(e){de(y.guest_key);var s=(new Date).getTime();if(void 0===k.id||le(k.id,s)){var t={};n.successFunc(t)}else n.errorFunc(a,"WebSocket is not connected yet.");_e(!0)},S.onmessage=function(e){F=(new Date).getTime();for(var n=e.data.split("\n"),s=0;s<n.length;s++)if(0!=n[s].trim().length){var t=n[s].substring(0,4),i=n[s].substring(4);if(0!==t.trim().length||0!==i.trim().length)if(t===h.PONG)me(!1);else if(t==h.MCUP){var r=JSON.parse(i);$(r.channel_id)}else C(t,i)}},S.onerror=function(e){t("=== Web Socket onerror ==="),t(e),_isLeavingPage||oe(),_e(!1),me(!1)},S.onclose=function(e){t("=== Web Socket onclose ==="),t(e),_isLeavingPage||oe(),_e(!1),me(!1)}},ae=function(){t("=== Web Socket Disconnect ==="),ce()},oe=function(){null==P?(t("=== Start Reconnect ==="),P=setTimeout(function(){re(),P=null,t("=== Reconnect done ===")},3e3)):t("=== Reconnect is in progress. (skip) ===")},ce=function(){S&&ue(),k={},T=0,M=null,O=null,P=null,R=0},ue=function(){S&&(S.close(),S.onmessage=function(e){},S.onopen=function(e){},S.onerror=function(e){},S.onclose=function(e){},S=null),T=0},ge=function(){return S?S.readyState:WebSocket.CLOSED},pe=function(e,n){var s=e+JSON.stringify(n)+"\n";try{if(1!=S.readyState)return!1;S.send(s)}catch(i){return t(i),!1}return!0},de=function(e){pe(h.LOGI,{key:e})},le=function(e,n){return pe(h.JOIN,{channel_id:e,last_ts:n})},fe=function(){var e=(new Date).getTime();R=e,pe(h.PING,{id:e})},_e=function(e){null!=M&&(clearInterval(M),M=null),e?(t("=== Start Pinger ==="),M=setInterval(function(){var e=(new Date).getTime(),n=e-F,s=parseInt(n/1e3);s>0&&s%5==0&&(t(h.PING),fe(),me(!0))},1e3)):t("=== Stop Pinger ===")},me=function(e){null!=O&&(clearInterval(O),O=null),e?(t("=== Start Watchdog ==="),O=setInterval(function(){var e=(new Date).getTime(),n=e-F,s=parseInt(n/1e3);s>=20&&(t("=== Watchdog Barks! ==="),_e(!1),oe())},4500)):t("=== Watchdog ===")},ve=function(e,n){"string"!=typeof e&&(e=e.toString()),n=n||"";var s=pe(h.MESG,{channel_id:k.id,message:e,data:"",tid:n});L.onMessageDelivery({sent:s,message:e,data:"",id:n}),s&&k.isMessaging&&setTimeout(function(){te()},100)},Se=function(e,n,s){"string"!=typeof e&&(e=e.toString()),s=s||"";var t=pe(h.MESG,{channel_id:k.id,message:e,data:n,tid:s});L.onMessageDelivery({sent:t,message:e,data:n,tid:s}),t&&k.isMessaging&&setTimeout(function(){te()},100)},he=function(e){pe(h.FILE,{channel_id:k.id,name:e.name,url:e.url,type:e.type,size:e.size,custom:e.custom})},ye=function(e){n=e},ke=function(e){var n=e.substring(0,4),s=JSON.parse(e.substring(4));return{cmd:n,payload:s}},Fe=function(e){return e==h.MESG},Te=function(e){return e==h.FILE},Me=function(e){var n=e.url.split("."),s=n[n.length-1];return"png"==s||"jpeg"==s||"jpg"==s||"gif"==s||"bmp"==s?!0:e.type.indexOf("image")>=0},Oe=function(e){return e==B},Pe=function(e){return e==J},Re=function(e){var n=!1;try{n=JSON.parse(k.data).freeze}catch(s){n=!1}e({channel_url:k.channel_url,cover_img_url:k.cover_img_url,member_count:k.member_count,name:k.name,isMessaging:k.isMessaging,max_length_message:k.max_length_message,freeze:n})},Ne=function(e){e({guest_id:y.guest_id,image_url:y.image_url,nickname:y.user_name})},we=function(e){y.gcm_reg_token=e},be=function(e){y.apns_device_token=e},Ie="[version] "+_,Ce=function(e){T="string"==typeof e?parseInt(e):e};return{version:Ie,events:L,joinChannel:G,leaveChannel:A,getMemberList:U,getChannelSearch:x,getChannelList:W,joinMessagingChannel:j,startMessaging:q,inviteMessaging:H,endMessaging:Y,getMessagingChannelList:Z,getPrivateChannelList:K,markAsRead:Q,getMessageLoadMore:V,getUserList:ee,sendFile:ne,typeStart:se,typeEnd:te,deleteMessage:ie,connect:re,disconnect:ae,message:ve,messageWithData:Se,sendFileURL:he,setDebugMessage:ye,isMessage:Fe,isFileMessage:Te,hasImage:Me,isGroupMessaging:Oe,isGroupMessagingChannel:Oe,isMessagingChannel:Pe,getChannelInfo:Re,getUserInfo:Ne,getConnectionState:ge,registerGCMToken:we,registerAPNSToken:be,init:u,setMinMessageTs:Ce}};return o});